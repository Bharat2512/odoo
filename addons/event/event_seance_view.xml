<?xml version="1.0" encoding="UTF-8"?>
<openerp>
    <data>

        <!-- EVENTS CONTENT -->
        <record model="ir.ui.view" id="view_event_content_tree">
            <field name="name">event.content.tree</field>
            <field name="model">event.content</field>
            <field name="arch" type="xml">
                <tree string="Contents">
                    <field name="sequence" widget="handle"/>
                    <field name="name"/>
                    <field name="type_id"/>
                    <field name="module_id"/>
                    <field name="duration" sum="Duration" widget="float_time"/>
                    <field name="slot_info"/>
                    <field name="is_divided" invisible="1"/>
                    <button type="object" name="button_open_group_registration_dispatch"
                            icon="terp-personal"
                            string="Dispatch registration between groups"
                            attrs="{'invisible': [('is_divided','=',False)]}"/>
                </tree>
            </field>
        </record>

        <record model="ir.ui.view" id="view_event_content_form">
            <field name="name">event.content.form</field>
            <field name="model">event.content</field>
            <field name="arch" type="xml">
                <form string="Content" version="7.0">
                    <sheet>
                        <div class="oe_title">
                            <label for="name"/>
                            <h2><field name="name"/></h2>
                        </div>
                        <notebook>
                            <page string="Content &amp; Planning">
                                <group>
                                    <group>
                                          <label for="duration"/>
                                          <div>
                                            <!-- slot_count x slot_duration = duration -->
                                            <field name="slot_count" class="oe_inline oe_offer_content_duration" readonly="0" on_change="onchange_duration('slot_count', slot_count, slot_duration, duration, context)"/> x <field name="slot_duration" class="oe_inline oe_offer_content_duration" widget="float_time" on_change="onchange_duration('slot_duration', slot_count, slot_duration, duration, context)"/> = <field name="duration" class="oe_inline oe_offer_content_duration" widget="float_time" on_change="onchange_duration('duration', slot_count, slot_duration, duration, context)"/>
                                          </div>
                                          <field name="room_id" domain="[('room','=',1)]"/>
                                          <field name="speaker_id" domain="[('speaker','=',1)]"/>
                                        </group>
                                    <group>
                                        <field name="sequence" invisible="1"/>
                                        <field name="type_id"/>
                                        <field name="module_id"/>
                                        <field name="is_divided"/>
                                    </group>
                                </group>
                            </page>
                            <page string="Groups" attrs="{'invisible': [('is_divided','=',False)]}">
                                <field name="group_ids" context="{'current_group_ids': group_ids}">
                                    <tree string="Groups" editable="bottom">
                                        <field name="name"/>
                                        <field name="is_default"/>
                                    </tree>
                                </field>
                            </page>
                        </notebook>
                    </sheet>
                </form>
            </field>
        </record>

        <record id="view_event_content_module_tree" model="ir.ui.view">
            <field name="name">event.content.module.tree</field>
            <field name="model">event.content.module</field>
            <field name="arch" type="xml">
                <tree string="Modules">
                    <field name="name"/>
                </tree>
            </field>
        </record>

        <record id="view_event_content_module_form" model="ir.ui.view">
            <field name="name">event.content.module.form</field>
            <field name="model">event.content.module</field>
            <field name="arch" type="xml">
                <form string="Modules">
                    <field name="name"/>
                </form>
            </field>
        </record>

        <record id="view_event_type_form_seance" model="ir.ui.view">
            <field name="name">event.type.form.seance</field>
            <field name="model">event.type</field>
            <field name="inherit_id" ref="event.view_event_type_form"/>
            <field name="arch" type="xml">
                <field name="default_registration_min" position="before">
                    <field name="default_has_program"/>
                    <field name="default_content_planification" attrs="{'readonly': [('default_has_program','=',False)]}"/>
                </field>
            </field>
        </record>

        <record id="action_event_2_seance_link" model="ir.actions.act_window">
            <field name="name">Seances</field>
            <field name="res_model">event.seance</field>
            <field name="view_type">form</field>
            <field name="view_mode">calendar,tree,form</field>
            <field name="context">{'search_default_event_ids': active_id}</field>
            <field name="domain">[]</field>
        </record>

        <record id="view_event_form_seance" model="ir.ui.view">
            <field name="name">event.event.form.seance</field>
            <field name="model">event.event</field>
            <field name="inherit_id" ref="event.view_event_form"/>
            <field name="arch" type="xml">
                <xpath expr="//div[@class='options_active']" position="inside">
                    <field name="has_program" on_change="onchange_has_program(has_program, date_begin, content_ids, context)"/><label for="has_program"/>
                </xpath>
                <field name="date_end" position="attributes">
                    <attribute name="attrs">{'readonly': ['|',('state','!=','draft'),('has_program','=',True)],
                                             'required': [('has_program','=',False)]}</attribute>
                </field>
                <page string="Information" position="after">
                    <page string="Program &amp; Schedule" attrs="{'invisible': [('has_program','=',False)]}">
                        <group>
                            <group>
                                <label for="calendar_id" string="Schedule"/>
                                <div>
                                    <field name="calendar_id" context="{'show_week_hours': 1}" options="{'always_reload': True}"/>
                                    <span attrs="{'invisible': [('calendar_id','!=',False)]}" groups="base.group_user">No hours specified, OpenERP will consider 24/24 7/7 hours</span>
                                    <button type="action" name="%(event.action_event_leaves)d"
                                            string="(configure event vacations)" class="oe_link"/>
                                </div>
                            </group>
                            <group>
                                <label for="content_planification" string="Schedule mode"/>
                                <div>
                                    <field name="content_planification" class="oe_inline"/>
                                    <button type="object" name="recompute_seances" class="oe_link" string="(recompute seances)"
                                            attrs="{'invisible': [('content_planification', '!=', 'linear')]}"/>
                                    <button type="object" name="open_preplanning" class="oe_link" string="(=> open preplanning)"
                                            attrs="{'invisible': [('content_planification', '!=', 'preplanning')]}"/>
                                </div>
                            </group>
                        </group>
                        <field name="content_ids" widget="one2many" attrs="{'readonly': [('state','!=','draft')]}"
                               context="{'calendar_id': calendar_id}"/>
                    </page>
                </page>
                <xpath expr="//div[contains(@class, 'oe_button_box')]" position="inside">
                    <button type="action" name="%(action_event_2_seance_link)d" string="Seances"
                            attrs="{'invisible': [('has_program','=',False)]}"/>
                </xpath>
            </field>
        </record>

        <record id="view_event_seance_type_tree" model="ir.ui.view">
            <field name="name">event.seance.type.tree</field>
            <field name="model">event.seance.type</field>
            <field name="arch" type="xml">
                <tree string="Seance Types">
                    <field name="name"/>
                </tree>
            </field>
        </record>

        <record id="view_event_seance_type_form" model="ir.ui.view">
            <field name="name">event.seance.type.form</field>
            <field name="model">event.seance.type</field>
            <field name="arch" type="xml">
                <form string="Seance Type" version="7.0">
                    <sheet>
                        <div class="oe_title">
                            <label for="name" class="oe_edit_only"/>
                            <h1><field name="name"/></h1>
                        </div>
                    </sheet>
                </form>
            </field>
        </record>

        <record id="view_event_seance_type_search" model="ir.ui.view">
            <field name="name">event.seance.type.search</field>
            <field name="model">event.seance.type</field>
            <field name="arch" type="xml">
                <search string="Seance Types">
                    <field name="name"/>
                </search>
            </field>
        </record>

        <record id="action_event_seance_type" model="ir.actions.act_window">
            <field name="name">Type of Seances</field>
            <field name="res_model">event.seance.type</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="search_view_id" ref="view_event_seance_type_search"/>
        </record>

        <menuitem id="menu_event_seance_type" parent="base.menu_marketing_config_root"
                  action="action_event_seance_type" groups="base.group_no_one"/>


        <record id="action_seance_2_participant_link" model="ir.actions.act_window">
            <field name="name">Participants</field>
            <field name="res_model">event.participation</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="context">{'search_default_seance_id': active_id}</field>
            <field name="domain">[('role', '=', 'participant')]</field>
        </record>

        <record id="view_event_seance_tree" model="ir.ui.view">
            <field name="name">event.seance.tree</field>
            <field name="model">event.seance</field>
            <field name="arch" type="xml">
                <tree string="Seances">
                    <field name="name"/>
                    <field name="type_id"/>
                    <field name="date_begin"/>
                    <field name="duration" widget="float_time"/>
                    <field name="address_id"/>
                    <field name="main_speaker_id"/>
                    <field name="content_id" invisible="1"/>
                    <field name="group_id" invisible="1"/>
                    <field name="module_id" invisible="1"/>
                    <field name="state"/>
                </tree>
            </field>
        </record>

        <record id="view_event_seance_kanban" model="ir.ui.view">
            <field name="name">event.seance.kanban</field>
            <field name="model">event.seance</field>
            <field name="arch" type="xml">
                <kanban string="Seances" version="7.0">
                    <field name="name"/>
                    <field name="event_ids"/>
                    <field name="participant_ids"/>
                    <templates>
                        <t t-name="kanban-box">
                            <div calss="oe_kanban_card oe_kanban_global_click">
                                <div><b><field name="name"/></b></div>
                                <div>
                                    <field name="event_ids" widget="many2many_tags"/>
                                </div>
                                <span><span class="oe_i">x</span><t t-expr="#{record.participant_ids.length}"/></span>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>

        <record id="view_event_seance_form" model="ir.ui.view">
            <field name="name">event.seance.form</field>
            <field name="model">event.seance</field>
            <field name="arch" type="xml">
                <form string="Seance" version="7.0">
                    <header>
                        <button type="object" name="button_set_draft" states="cancel,done,planned" string="Set Draft"/>
                        <button type="object" name="button_set_planned" states="draft" string="Set Planned"/>
                        <button type="object" name="button_set_confirm" states="draft,planned" string="Confirm"/>
                        <button type="object" name="button_set_inprogress" states="confirm" string="Start seance"/>
                        <button type="object" name="button_set_closed" states="inprogress" string="Stop seance"/>
                        <button type="object" name="button_set_done" states="confirm,inprogress,closed" string="Done"/>
                        <field name="state" widget="statusbar" statusbar_visible="draft,confirmed,done"/>
                    </header>
                    <sheet>
                        <div class="oe_right oe_button_box">
                            <button type="action" name="%(event.action_seance_2_participant_link)d"
                                    string="Participants"/>
                        </div>
                        <div class="oe_title">
                            <label for="name" class="oe_edit_only"/>
                            <h1><field name="name"/></h1>
                        </div>
                        <notebook>
                            <page string="Information">
                                <group>
                                    <group>
                                        <field name="type_id" options="{'no_open': True}"/>
                                        <field name="main_speaker_id" context="{'default_speaker': 1, 'fb_from': date_begin, 'fb_duration': duration}"/>
                                        <field name="address_id" context="{'show_address': 1, 'fb_from': date_begin, 'fb_duration': duration}" options="{'always_reload': True}"/>
                                    </group>
                                    <group>
                                        <field name="date_begin"/>
                                        <field name="duration" widget="float_time"/>
                                        <field name="event_ids" widget="many2many_tags" string="Related Events"/>
                                    </group>
                                </group>
                            </page>
                            <page string="Participant">
                                <group>
                                    <group>
                                        <field name="participant_min"/>
                                        <field name="participant_max"/>
                                    </group>
                                    <group>
                                    </group>
                                </group>
                                <field name="participant_ids">
                                    <tree string="Participants">
                                        <field name="partner_id"/>
                                        <field name="registration_id"/>
                                        <field name="presence"/>
                                    </tree>
                                </field>
                            </page>
                            <page string="Configuration" groups="event.group_event_manager">
                                <group>
                                    <group>
                                        <field name="content_id"/>
                                        <field name="module_id"/>
                                        <field name="group_id"/>
                                    </group>
                                    <group>
                                    </group>
                                </group>
                            </page>
                        </notebook>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers" groups="base.group_user"/>
                        <field name="message_ids" widget="mail_thread"/>
                    </div>
                </form>
            </field>
        </record>

        <record id="view_event_seance_search" model="ir.ui.view">
            <field name="name">event.seance.search</field>
            <field name="model">event.seance</field>
            <field name="arch" type="xml">
                <search string="Event Seances">
                    <field name="name"/>
                    <field name="event_ids"/>
                    <field name="main_speaker_id"/>
                    <field name="address_id"/>
                    <field name="type_id"/>
                    <field name="module_id"/>
                    <group expand="0" string="Group By...">
                        <filter string="Type" name="type" domain="[]" context="{'group_by': 'type_id'}"/>
                        <filter string="Content" name="content" domain="[]" context="{'group_by': 'content_id'}"/>
                        <filter string="Module" name="group_module" domain="[]" context="{'group_by': 'module_id'}"/>
                        <filter string="Speaker" name="speaker" domain="[]" context="{'group_by': 'main_speaker_id'}"/>
                        <filter string="Address" name="address" domain="[]" context="{'group_by': 'address_id'}"/>
                        <filter string="Group" name="group" domain="[]" context="{'group_by': 'group_id'}"/>
                    </group>
                </search>
            </field>
        </record>

        <record id="view_event_seance_calendar" model="ir.ui.view">
            <field name="name">event.seance.calendar</field>
            <field name="model">event.seance</field>
            <field name="arch" type="xml">
                <calendar string="Seances" date_start="date_begin" date_delay="duration" color="type_id" mode="week">
                    <field name="name"/>
                    <field name="content_id"/>
                    <field name="group_id"/>
                    <field name="main_speaker_id"/>
                    <field name="address_id"/>
                    <field name="participant_ids"/>
                    <templates>
                        <t t-name="calendar-text-box">
                            <field name="name"/>
                        </t>
                        <t t-name="calendar-info-box">
                            <div>
                                <t t-if="record.group_id.raw_value">
                                    <span>Group: <field name="group_id"/></span><br/>
                                </t>
                                <t t-if="record.main_speaker_id.raw_value">
                                    <span>Speaker: <field name="main_speaker_id"/></span><br/>
                                </t>
                                <span>Participant(s): <t t-esc="record.participant_ids.raw_value.length"/></span><br/>
                            </div>
                        </t>
                    </templates>
                </calendar>
            </field>
        </record>

        <record id="action_event_seance" model="ir.actions.act_window">
            <field name="name">Seances</field>
            <field name="res_model">event.seance</field>
            <field name="view_type">form</field>
            <field name="view_mode">calendar,tree,form</field>
            <field name="search_view_id" ref="view_event_seance_search"/>
        </record>

        <menuitem id="menu_event_seance" parent="menu_event_management_root"
                  action="action_event_seance"/>

        <record id="view_event_participation_tree" model="ir.ui.view">
            <field name="name">event.participation.tree</field>
            <field name="model">event.participation</field>
            <field name="arch" type="xml">
                <tree string="Participants">
                    <field name="name"/>
                    <field name="partner_id"/>
                    <field name="seance_id"/>
                    <field name="registration_id"/>
                    <field name="presence" invisible="1"/>
                    <field name="presence_summary"/>
                    <button name="button_take_presence" type="object"
                            string="Mark as Present" icon="kanban-apply"
                            attrs="{'invisible': ['|',('state','!=','draft'),('presence','=','present')]}"
                            context="{'presence': 'present'}"/>
                    <button name="button_take_presence_2" type="object"
                            string="Mark as Absent" icon="kanban-stop"
                            attrs="{'invisible': ['|', ('state','!=','draft'),('presence','=','absent')]}"
                            context="{'presence': 'absent'}"/>
                    <button name="%(action_event_participation_take_presence_wizard)d" type="action"
                            string="Mark as Late" icon="kanban-pause"
                            attrs="{'invisible': ['|',('state','!=','draft'),('presence','=','late')]}"
                            context="{'default_status': 'late'}"/>
                    <field name="state"/>
                </tree>
            </field>
        </record>

        <record id="view_event_participation_form" model="ir.ui.view">
            <field name="name">event.participation.form</field>
            <field name="model">event.participation</field>
            <field name="arch" type="xml">
                <form string="Participant" version="7.0">
                    <header>
                        <field name="state" widget="statusbar" statusbar_visible="draft,done"/>
                    </header>
                    <sheet>
                        <div class="oe_right oe_button_box" name="buttons">
                            <button name="button_take_presence" type="object"
                                    string="Mark as Present" icon="kanban-apply"
                                    attrs="{'invisible': ['|',('state','!=','draft'),('presence','=','present')]}"
                                    context="{'presence': 'present'}"/>
                            <button name="button_take_presence" type="object"
                                    string="Mark as Absent" icon="kanban-stop"
                                    attrs="{'invisible': ['|', ('state','!=','draft'),('presence','=','absent')]}"
                                    context="{'presence': 'absent'}"/>
                            <button name="%(action_event_participation_take_presence_wizard)d" type="action"
                                    string="Mark as Late" icon="kanban-pause"
                                    attrs="{'invisible': ['|',('state','!=','draft'),('presence','=','late')]}"
                                    context="{'default_status': 'late'}"/>
                        </div>
                        <div class="oe_title">
                            <label for="name" class="oe_edit_only"/>
                            <h1><field name="name"/></h1>
                        </div>
                        <notebook>
                            <page string="Information">
                                <group>
                                    <group>
                                        <field name="seance_id"/>
                                        <field name="registration_id" on_change="onchange_registration(registration_id)"/>
                                        <field name="partner_id"/>
                                    </group>
                                    <group>
                                        <field name="presence" invisible="1"/>
                                        <field name="presence_summary"/>
                                        <field name="arrival_time"/>
                                        <field name="departure_time"/>
                                    </group>
                                </group>
                            </page>
                        </notebook>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers"/>
                        <field name="message_ids" widget="mail_thread"/>
                    </div>
                </form>
            </field>
        </record>

        <record id="view_event_participation_search" model="ir.ui.view">
            <field name="name">event.participation.search</field>
            <field name="model">event.participation</field>
            <field name="arch" type="xml">
                <search string="Participants">
                    <field name="name"/>
                    <field name="partner_id"/>
                    <field name="seance_id"/>
                </search>
            </field>
        </record>

        <record id="action_event_participant" model="ir.actions.act_window">
            <field name="name">Participants</field>
            <field name="res_model">event.participation</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[('role', '=', 'participant')]</field>
            <field name="search_view_id" ref="view_event_participation_search"/>
        </record>

        <menuitem id="menu_event_participant" parent="menu_event_management_root"
                  action="action_event_participant"/>

        <record model="ir.ui.view" id="view_event_participation_group_tree">
            <field name="name">event.participation.group.tree</field>
            <field name="model">event.participation.group</field>
            <field name="arch" type="xml">
                <tree string="Groups">
                    <field name="name"/>
                    <field name="participant_count"/>
                    <field name="is_default"/>
                </tree>
            </field>
        </record>

        <record model="ir.ui.view" id="view_event_participation_group_form">
            <field name="name">event.participation.group.form</field>
            <field name="model">event.participation.group</field>
            <field name="arch" type="xml">
                <form string="Group" version="7.0">
                    <sheet>
                        <div class="oe_title">
                            <label for="name" class="oe_edit_only"/>
                            <h2><field name="name"/></h2>
                        </div>
                        <group>
                            <field name="is_default"/>
                        </group>
                        <field name="registration_ids" colspan="4"/>
                    </sheet>
                </form>
            </field>
        </record>

        <record model="ir.ui.view" id="view_event_registration_form_seance">
            <field name="name">event.registration.form.seance</field>
            <field name="model">event.registration</field>
            <field name="inherit_id" ref="event.view_event_registration_form"/>
            <field name="arch" type="xml">
                <field name="date_closed" position="after">
                    <field name="group_ids" widget="many2many_tags" attrs="{'readonly': [('state','=','done')]}"
                            domain="[('event_content_id.event_ids','in',[event_id])]"
                            on_change="onchange_group_ids(event_id, group_ids)"/>
                </field>
            </field>
        </record>

    </data>
</openerp>