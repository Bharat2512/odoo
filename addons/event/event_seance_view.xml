<?xml version="1.0" encoding="UTF-8"?>
<openerp>
    <data>

        <!-- EVENTS CONTENT -->
        <record model="ir.ui.view" id="view_event_content_tree">
            <field name="name">event.content.tree</field>
            <field name="model">event.content</field>
            <field name="arch" type="xml">
                <tree string="Contents">
                    <field name="sequence" widget="handle"/>
                    <field name="name"/>
                    <field name="type_id"/>
                    <field name="lang_id"/>
                    <field name="module_id"/>
                    <field name="duration" sum="Duration" widget="float_time"/>
                    <field name="slot_info"/>
                    <field name="is_divided" invisible="1"/>
                    <field name="course_id" invisible="1"/>
                    <field name="speaker_id" invisible="1"/>
                    <field name="room_id" invisible="1"/>
                    <button type="object" name="button_open_group_registration_dispatch"
                            icon="terp-personal"
                            string="Dispatch registration between groups"
                            attrs="{'invisible': [('is_divided','=',False)]}"/>
                </tree>
            </field>
        </record>

        <record model="ir.ui.view" id="view_event_content_form">
            <field name="name">event.content.form</field>
            <field name="model">event.content</field>
            <field name="arch" type="xml">
                <form string="Content" version="7.0">
                    <sheet>
                        <div class="oe_title">
                            <label for="name" class="oe_edit_only"/>
                            <h2><field name="name"/></h2>
                        </div>
                        <notebook>
                            <page string="Content &amp; Planning">
                                <group>
                                    <group>
                                          <label for="duration"/>
                                          <div>
                                            <!-- slot_count x slot_duration = duration -->
                                            <field name="slot_count" class="oe_inline oe_offer_content_duration" readonly="0" on_change="onchange_duration('slot_count', slot_count, slot_duration, duration, context)"/> x <field name="slot_duration" class="oe_inline oe_offer_content_duration" widget="float_time" on_change="onchange_duration('slot_duration', slot_count, slot_duration, duration, context)"/> = <field name="duration" class="oe_inline oe_offer_content_duration" widget="float_time" on_change="onchange_duration('duration', slot_count, slot_duration, duration, context)"/>
                                          </div>
                                          <field name="room_id" domain="[('room','=',1)]"/>
                                          <field name="speaker_id" domain="[('speaker','=',1)]"/>
                                          <field name="constraint_ids" widget="many2many_tags"/>
                                        </group>
                                    <group>
                                        <field name="sequence" invisible="1"/>
                                        <field name="event_ids" widget="many2many_tags" readonly="1" invisible="context.get('from_event')"/>
                                        <field name="type_id" on_change="onchange_type(type_id)"/>
                                        <field name="lang_id"/>
                                        <field name="module_id"/>
                                        <field name="is_divided"/>
                                    </group>
                                </group>
                            </page>
                            <page string="Groups" attrs="{'invisible': [('is_divided','=',False)]}">
                                <field name="group_ids" context="{'current_group_ids': group_ids}">
                                    <tree string="Groups" editable="bottom">
                                        <field name="name"/>
                                        <field name="is_default"/>
                                        <field name="speaker_id" domain="[('speaker','=',1)]"/>
                                        <field name="room_id" domain="[('room','=',1)]"/>
                                    </tree>
                                </field>
                            </page>
                        </notebook>
                    </sheet>
                </form>
            </field>
        </record>

        <record id="view_event_content_search" model="ir.ui.view">
            <field name="name">event.content.search</field>
            <field name="model">event.content</field>
            <field name="arch" type="xml">
                <search string="Contents">
                    <field name="name"/>
                    <field name="event_ids"/>
                    <field name="course_id"/>
                    <field name="speaker_id"/>
                    <field name="room_id"/>
                    <filter string="Divided" name="divided" domain="[('is_divided','=',True)]"/>
                    <group string="Group By...">
                        <filter string="Course" name="group_course" context="{'group_by': 'course_id'}"/>
                        <filter string="Default Speaker" name="group_speaker" context="{'group_by': 'speaker_id'}"/>
                        <filter string="Default room" name="group_room" context="{'group_by': 'room_id'}"/>
                    </group>
                </search>
            </field>
        </record>

        <record id="view_event_content_module_tree" model="ir.ui.view">
            <field name="name">event.content.module.tree</field>
            <field name="model">event.content.module</field>
            <field name="arch" type="xml">
                <tree string="Modules">
                    <field name="name"/>
                    <field name="date_begin" invisible="not context.get('event_id')"/>
                    <field name="date_end" invisible="not context.get('event_id')"/>
                </tree>
            </field>
        </record>

        <record id="view_event_content_module_form" model="ir.ui.view">
            <field name="name">event.content.module.form</field>
            <field name="model">event.content.module</field>
            <field name="arch" type="xml">
                <form string="Modules">
                    <field name="name"/>
                </form>
            </field>
        </record>

        <act_window id="link_event_2_module"
            name="Modules (summary)"
            src_model="event.event"
            res_model="event.content.module"
            view_type="form"
            view_mode="tree,form"
            key2="client_action_relate"
            context="{'event_id': active_id}"/>

        <record id="view_event_type_form_seance" model="ir.ui.view">
            <field name="name">event.type.form.seance</field>
            <field name="model">event.type</field>
            <field name="inherit_id" ref="event.view_event_type_form"/>
            <field name="arch" type="xml">
                <field name="default_registration_min" position="before">
                    <field name="default_has_program"/>
                    <field name="default_content_planification" attrs="{'readonly': [('default_has_program','=',False)]}"/>
                </field>
            </field>
        </record>

        <record id="action_event_2_seance_link" model="ir.actions.act_window">
            <field name="name">Seances</field>
            <field name="res_model">event.seance</field>
            <field name="view_type">form</field>
            <field name="view_mode">calendar,tree,form</field>
            <field name="context">{'search_default_event_ids': active_id}</field>
            <field name="domain">[]</field>
        </record>

        <record id="view_event_form_seance" model="ir.ui.view">
            <field name="name">event.event.form.seance</field>
            <field name="model">event.event</field>
            <field name="inherit_id" ref="event.view_event_form"/>
            <field name="arch" type="xml">
                <xpath expr="//div[contains(@class, 'oe_button_box')]" position="inside">
                    <button type="action" name="%(action_event_2_seance_link)d" string="Seances"
                            attrs="{'invisible': [('has_program','=',False)]}" states="template,draft,confirm,done"/>
                </xpath>
                <xpath expr="//div[@class='options_active']" position="inside">
                    <field name="has_program" on_change="onchange_has_program(has_program, date_begin, content_ids, context)"/><label for="has_program"/>
                </xpath>
                <field name="date_end" position="attributes">
                    <attribute name="attrs">{'readonly': ['|',('state','!=','draft'),('has_program','=',True)],
                                             'required': [('has_program','=',False)]}</attribute>
                </field>
                <page string="Information" position="after">
                    <page string="Program &amp; Schedule" attrs="{'invisible': [('has_program','=',False)]}">
                        <group>
                            <group>
                                <label for="calendar_id" string="Schedule"/>
                                <div>
                                    <field name="calendar_id" context="{'show_week_hours': 1}" options="{'always_reload': True}"/>
                                    <span attrs="{'invisible': [('calendar_id','!=',False)]}" groups="base.group_user">No hours specified, OpenERP will consider 24/24 7/7 hours</span>
                                    <button type="action" name="%(event.action_event_leaves)d"
                                            string="(configure event vacations)" class="oe_link" states="draft,confirm"
                                            context="{'default_event_id': active_id}"/>
                                </div>
                            </group>
                            <group>
                                <label for="content_planification" string="Schedule mode"/>
                                <div>
                                    <field name="content_planification" class="oe_inline"/>
                                    <button type="object" name="recompute_seances" class="oe_link" string="(recompute seances)"
                                            attrs="{'invisible': [('content_planification', '!=', 'linear')]}" states="draft,confirm"/>
                                    <button type="object" name="open_preplanning" class="oe_link" string="(=> open preplanning)"
                                            attrs="{'invisible': [('content_planification', '!=', 'preplanning')]}" states="draft,confirm,done"/>
                                </div>
                            </group>
                        </group>
                        <field name="content_ids" widget="one2many" attrs="{'readonly': [('state','not in',['template',  'draft'])]}"
                               context="{'calendar_id': calendar_id, 'from_event': 1}"/>
                    </page>
                </page>
            </field>
        </record>

        <record id="view_event_event_kanban_seance" model="ir.ui.view">
            <field name="name">event.event.kanban.seance</field>
            <field name="model">event.event</field>
            <field name="inherit_id" ref="event.view_event_kanban"/>
            <field name="arch" type="xml">
                <field name="state" position="after">
                    <field name="has_program"/>
                    <field name="content_planification"/>
                </field>
                <xpath expr="//templates/t[@t-name='kanban-box']//div[@class='oe_module_desc']/h4" position="after">
                    <p groups="base.group_user">
                        <t t-if="record.content_planification.raw_value == 'preplanning' and ['draft', 'confirm', 'done'].indexOf(record.state.raw_value) != -1">
                            <a type="object" name="open_preplanning" string="Open preplanning">
                                <img src="/web/static/src/img/icons/terp-calendar.png"/>
                            </a>
                        </t>
                        <t t-if="record.has_program.raw_value and ['draft', 'confirm', 'done'].indexOf(record.state.raw_value) != -1">
                            <a type="action" name="%(action_event_2_seance_link)d" string="Seances">
                                <img src="/web/static/src/img/icons/terp-go-week.png"/>
                            </a>
                        </t>
                    </p>
                </xpath>
            </field>
        </record>

        <record id="view_event_seance_type_tree" model="ir.ui.view">
            <field name="name">event.seance.type.tree</field>
            <field name="model">event.seance.type</field>
            <field name="arch" type="xml">
                <tree string="Seance Types">
                    <field name="name"/>
                    <field name="included_into_analysis"/>
                    <field name="manual_participation"/>
                </tree>
            </field>
        </record>

        <record id="view_event_seance_type_form" model="ir.ui.view">
            <field name="name">event.seance.type.form</field>
            <field name="model">event.seance.type</field>
            <field name="arch" type="xml">
                <form string="Seance Type" version="7.0">
                    <sheet>
                        <div class="oe_title">
                            <label for="name" class="oe_edit_only"/>
                            <h1><field name="name"/></h1>
                        </div>
                        <group>
                            <group>
                                <field name="included_into_analysis"/>
                                <field name="manual_participation"/>
                            </group>
                            <group>
                            </group>
                        </group>
                        <group>
                            <group string="Purchase">
                                <field name="speaker_product_id"/>
                                <field name="room_product_id"/>
                                <field name="equipment_product_id"/>
                            </group>
                            <group string="Limits">
                                <field name="speaker_min_required"/>
                                <field name="room_required"/>
                            </group>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>

        <record id="view_event_seance_type_search" model="ir.ui.view">
            <field name="name">event.seance.type.search</field>
            <field name="model">event.seance.type</field>
            <field name="arch" type="xml">
                <search string="Seance Types">
                    <field name="name"/>
                </search>
            </field>
        </record>

        <record id="action_event_seance_type" model="ir.actions.act_window">
            <field name="name">Type of Seances</field>
            <field name="res_model">event.seance.type</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="search_view_id" ref="view_event_seance_type_search"/>
        </record>

        <menuitem id="menu_event_seance_type" parent="base.menu_marketing_config_root"
                  action="action_event_seance_type" groups="base.group_no_one"/>


        <record id="action_seance_2_participant_link" model="ir.actions.act_window">
            <field name="name">Participants</field>
            <field name="res_model">event.participation</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="context">{'search_default_seance_id': active_id}</field>
            <field name="domain">[('role', '=', 'participant')]</field>
        </record>

        <record id="view_event_seance_tree" model="ir.ui.view">
            <field name="name">event.seance.tree</field>
            <field name="model">event.seance</field>
            <field name="arch" type="xml">
                <tree string="Seances">
                    <field name="name"/>
                    <field name="event_ids"/>
                    <field name="lang_id"/>
                    <field name="type_id"/>
                    <field name="date_begin"/>
                    <field name="duration" widget="float_time"/>
                    <field name="address_id"/>
                    <field name="main_speaker_id"/>
                    <field name="content_id" invisible="1"/>
                    <field name="group_id" invisible="1"/>
                    <field name="module_id" invisible="1"/>
                    <field name="state"/>
                </tree>
            </field>
        </record>

        <record id="view_event_seance_kanban" model="ir.ui.view">
            <field name="name">event.seance.kanban</field>
            <field name="model">event.seance</field>
            <field name="arch" type="xml">
                <kanban string="Seances" version="7.0">
                    <field name="name"/>
                    <field name="event_ids"/>
                    <field name="participant_ids"/>
                    <templates>
                        <t t-name="kanban-box">
                            <div calss="oe_kanban_card oe_kanban_global_click">
                                <div><b><field name="name"/></b></div>
                                <div>
                                    <field name="event_ids" widget="many2many_tags"/>
                                </div>
                                <span><span class="oe_i">x</span><t t-expr="#{record.participant_ids.length}"/></span>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>

        <record id="view_event_seance_form" model="ir.ui.view">
            <field name="name">event.seance.form</field>
            <field name="model">event.seance</field>
            <field name="arch" type="xml">
                <form string="Seance" version="7.0">
                    <header>
                        <button type="object" name="button_set_draft" states="cancel,done,planned" string="Set Draft"/>
                        <button type="object" name="button_set_planned" states="draft" string="Set Planned"/>
                        <button type="object" name="button_set_confirm" states="draft,planned" string="Confirm"/>
                        <button type="object" name="button_set_inprogress" states="confirm" string="Start seance"/>
                        <button type="object" name="button_set_closed" states="inprogress" string="Stop seance"/>
                        <button type="object" name="button_set_done" states="confirm,inprogress,closed" string="Done"/>
                        <field name="state" widget="statusbar" statusbar_visible="draft,confirmed,done"/>
                    </header>
                    <sheet>
                        <div class="oe_right oe_button_box">
                            <button type="action" name="%(event.action_seance_2_participant_link)d"
                                    string="Participations"/>
                        </div>
                        <div class="oe_title">
                            <label for="name" class="oe_edit_only"/>
                            <h1><field name="name"/></h1>
                        </div>
                        <notebook>
                            <page string="Information">
                                <group>
                                    <group>
                                        <field name="type_id" options="{'no_open': True}"/>
                                        <field name="main_speaker_id" context="{'search_default_speaker': 1, 'default_speaker': 1, 'fb_from': date_begin, 'fb_duration': duration}"/>
                                        <field name="address_id" context="{'show_address': 1, 'fb_from': date_begin, 'fb_duration': duration, 'search_default_room': 1, 'default_room': 1}" options="{'always_reload': True}"/>
                                    </group>
                                    <group>
                                        <field name="date_begin"/>
                                        <field name="duration" widget="float_time"/>
                                        <field name="lang_id"/>
                                        <field name="event_ids" widget="many2many_tags" string="Related Events"/>
                                    </group>
                                </group>
                            </page>
                            <page string="Participant">
                                <group>
                                    <group>
                                        <field name="participant_min"/>
                                        <field name="participant_max"/>
                                    </group>
                                    <group>
                                    </group>
                                </group>
                                <field name="participant_ids">
                                    <tree string="Participants">
                                        <field name="partner_id"/>
                                        <field name="registration_id"/>
                                        <field name="presence"/>
                                        <field name="state" invisible="1"/>
                                    </tree>
                                </field>
                            </page>
                            <page string="Configuration" groups="event.group_event_manager,event.group_event_planning">
                                <group>
                                    <group>
                                        <field name="content_id" domain="[('event_ids', 'in', event_ids[0][2])]"
                                               on_change="onchange_content_id(content_id)" options="{'no_open': 1}"/>
                                        <field name="module_id"/>
                                        <field name="group_id" domain="[('event_content_id','=',content_id)]"/>
                                    </group>
                                    <group>
                                        <field name="constraint_ids" widget="many2many_tags"/>
                                    </group>
                                </group>
                                <separator string="Resources Assignments"/>
                                <field name="resource_participation_ids" options="{'reload_on_button': true}">
                                    <tree string="Resource Assignments" create="0" delete="0">
                                        <field name="role"/>
                                        <field name="partner_id" on_change="onchange_partner(partner_id)"/>
                                        <field name="name" invisible="1"/>
                                        <field name="purchase_product_id"/>
                                        <field name="purchase_price"/>
                                        <field name="purchase_qty"/>
                                        <field name="purchase_subtotal"/>
                                        <field name="state"/>
                                        <button name="button_set_draft"
                                            states="confirm,cancel"
                                            string="Set Draft" type="object"
                                            icon="terp-crm"/>
                                        <button name="button_set_confirm" string="Confirm"
                                            states="draft,cancel"
                                            type="object" icon="gtk-apply"/>
                                        <button name="button_set_cancel" string="Cancel"
                                            states="draft,confirm"
                                            type="object" icon="gtk-cancel"/>
                                    </tree>
                                </field>
                            </page>
                        </notebook>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers" groups="base.group_user"/>
                        <field name="message_ids" widget="mail_thread"/>
                    </div>
                </form>
            </field>
        </record>

        <record id="view_event_seance_search" model="ir.ui.view">
            <field name="name">event.seance.search</field>
            <field name="model">event.seance</field>
            <field name="arch" type="xml">
                <search string="Event Seances">
                    <field name="name"/>
                    <field name="event_ids"/>
                    <field name="main_speaker_id"/>
                    <field name="address_id"/>
                    <field name="type_id"/>
                    <field name="module_id"/>
                    <separator/>
                    <filter string="Upcoming" name="upcoming" domain="[('date_begin','>=',current_date)]"/>
                    <separator/>
                    <filter string="Draft" name="state_draft" domain="[('state','=','draft')]"/>
                    <filter string="Confirm" name="state_confirm" domain="[('state','=','confirm')]"/>
                    <filter string="Inprogress" name="state_inprogress" domain="[('state','=','inprogress')]"/>
                    <filter string="Done" name="state_done" domain="[('state','=','done')]"/>
                    <filter string="Cancelled" name="state_done" domain="[('state','=','cancelled')]"/>
                    <separator/>
                    <group expand="0" string="Group By...">
                        <filter string="Type" name="type" domain="[]" context="{'group_by': 'type_id'}"/>
                        <filter string="State" name="group_state" context="{'group_by': 'state'}"/>
                        <filter string="Content" name="content" domain="[]" context="{'group_by': 'content_id'}"/>
                        <filter string="Module" name="group_module" domain="[]" context="{'group_by': 'module_id'}"/>
                        <filter string="Speaker" name="speaker" domain="[]" context="{'group_by': 'main_speaker_id'}"/>
                        <filter string="Address" name="address" domain="[]" context="{'group_by': 'address_id'}"/>
                        <filter string="Group" name="group" domain="[]" context="{'group_by': 'group_id'}"/>
                    </group>
                </search>
            </field>
        </record>

        <record id="view_event_seance_calendar" model="ir.ui.view">
            <field name="name">event.seance.calendar</field>
            <field name="model">event.seance</field>
            <field name="arch" type="xml">
                <calendar string="Seances" date_start="date_begin" date_delay="duration" color="type_id" mode="week">
                    <field name="name"/>
                    <field name="content_id"/>
                    <field name="group_id"/>
                    <field name="main_speaker_id"/>
                    <field name="address_id"/>
                    <field name="participant_ids"/>
                    <templates>
                        <t t-name="calendar-text-box">
                            <field name="name"/>
                        </t>
                        <t t-name="calendar-info-box">
                            <div>
                                <t t-if="record.group_id.raw_value">
                                    <span>Group: <field name="group_id"/></span><br/>
                                </t>
                                <t t-if="record.main_speaker_id.raw_value">
                                    <span>Speaker: <field name="main_speaker_id"/></span><br/>
                                </t>
                                <span>Participant(s): <t t-esc="record.participant_ids.raw_value.length"/></span><br/>
                            </div>
                        </t>
                    </templates>
                </calendar>
            </field>
        </record>

        <record id="action_event_seance" model="ir.actions.act_window">
            <field name="name">Seances</field>
            <field name="res_model">event.seance</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form,calendar</field>
            <field name="search_view_id" ref="view_event_seance_search"/>
            <field name="context">{'search_default_upcoming': 1}</field>
        </record>

        <menuitem id="menu_event_seance" parent="menu_event_management_root"
                  action="action_event_seance"/>

        <record id="view_event_participation_tree" model="ir.ui.view">
            <field name="name">event.participation.tree</field>
            <field name="model">event.participation</field>
            <field name="arch" type="xml">
                <tree string="Participations">
                    <field name="name"/>
                    <field name="partner_id" invisible="1"/>
                    <field name="seance_event_ids"/>
                    <field name="seance_id"/>
                    <field name="duration"/>
                    <field name="presence" invisible="1"/>
                    <field name="presence_summary"/>
                    <button name="button_take_presence" type="object"
                            string="Mark as Present" icon="kanban-apply"
                            attrs="{'invisible': ['|',('state','in',['draft','confirm']),('presence','=','present')]}"
                            context="{'presence': 'present'}"/>
                    <button name="button_take_presence_2" type="object"
                            string="Mark as Absent" icon="kanban-stop"
                            attrs="{'invisible': ['|', ('state','in',['draft','confirm']),('presence','=','absent')]}"
                            context="{'presence': 'absent'}"/>
                    <button name="%(action_event_participation_take_presence_wizard)d" type="action"
                            string="Mark as Late" icon="kanban-pause"
                            attrs="{'invisible': ['|',('state','!=',['draft','confirm']),('presence','=','late')]}"
                            context="{'default_status': 'late'}"/>
                    <field name="state"/>
                </tree>
            </field>
        </record>

        <record id="view_event_participation_form" model="ir.ui.view">
            <field name="name">event.participation.form</field>
            <field name="model">event.participation</field>
            <field name="arch" type="xml">
                <form string="Participation" version="7.0">
                    <header>
                        <button name="button_set_draft"
                            states="confirm,cancel"
                            string="Set Draft" type="object"
                            icon="terp-crm"/>
                        <button name="button_set_confirm" string="Confirm"
                            states="draft,cancel"
                            type="object" icon="gtk-apply"/>
                        <button name="button_set_cancel" string="Cancel"
                            states="draft,confirm"
                            type="object" icon="gtk-cancel"/>
                        <field name="state" widget="statusbar" statusbar_visible="draft,done"/>
                    </header>
                    <sheet>
                        <div class="oe_right oe_button_box" name="buttons">
                            <button name="button_take_presence" type="object"
                                    string="Mark as Present" icon="kanban-apply"
                                    attrs="{'invisible': ['|',('state','not in',['draft','confirm']),('presence','=','present')]}"
                                    context="{'presence': 'present'}"/>
                            <button name="button_take_presence" type="object"
                                    string="Mark as Absent" icon="kanban-stop"
                                    attrs="{'invisible': ['|', ('state','not in',['draft','confirm']),('presence','=','absent')]}"
                                    context="{'presence': 'absent'}"/>
                            <button name="%(action_event_participation_take_presence_wizard)d" type="action"
                                    string="Mark as Late" icon="kanban-pause"
                                    attrs="{'invisible': ['|',('state','not in',['draft','confirm']),('presence','=','late')]}"
                                    context="{'default_status': 'late'}"/>
                        </div>
                        <div class="oe_title">
                            <label for="name" class="oe_edit_only"/>
                            <h1><field name="name"/></h1>
                        </div>
                        <notebook>
                            <page string="Information">
                                <group>
                                    <group>
                                        <field name="seance_id" on_change="onchange_seance(seance_id, context)"/>
                                        <field name="registration_id" on_change="onchange_registration(registration_id)"/>
                                        <field name="partner_id"/>
                                    </group>
                                    <group>
                                        <field name="presence" invisible="1"/>
                                        <field name="presence_summary"/>
                                        <field name="arrival_time"/>
                                        <field name="departure_time"/>
                                    </group>
                                </group>
                            </page>
                            <page string="Configuration" groups="base.group_no_one">
                                <group>
                                    <group></group>
                                    <group></group>
                                </group>
                            </page>
                        </notebook>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers"/>
                        <field name="message_ids" widget="mail_thread"/>
                    </div>
                </form>
            </field>
        </record>

        <record id="view_event_participation_search" model="ir.ui.view">
            <field name="name">event.participation.search</field>
            <field name="model">event.participation</field>
            <field name="arch" type="xml">
                <search string="Participations">
                    <field name="name"/>
                    <field name="partner_id"/>
                    <field name="seance_id" invisible="1"/>
                    <field name="name" filter_domain="[('seance_id.name', 'ilike', self)]" string="Seance Name"/>
                    <field name="state"/>
                    <separator/>
                    <filter name="state_draft" string="Draft" domain="[('state','=','draft')]"/>
                    <filter name="state_confirm" string="Confirm" domain="[('state','=','confirm')]"/>
                    <separator/>
                    <filter name="role_participant" string="Participant" domain="[('role','=','participant')]"/>
                    <filter name="role_speaker" string="Speaker" domain="[('role','=','speaker')]"/>
                    <filter name="role_room" string="Room/Seat" domain="[('role','=', 'room')]"/>
                    <filter name="role_equipment" string="Equipment" domain="[('role','=','equipment')]"/>
                    <separator/>
                    <field name="registration_id"/>
                    <group string="Group By...">
                        <filter name="group_state" string="State" context="{'group_by': 'state'}"/>
                    </group>
                </search>
            </field>
        </record>

        <record id="action_event_participation" model="ir.actions.act_window">
            <field name="name">Participations</field>
            <field name="res_model">event.participation</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[('role', '=', 'participant')]</field>
            <field name="search_view_id" ref="view_event_participation_search"/>
        </record>

        <menuitem id="menu_event_participant" parent="menu_event_management_root"
                  action="action_event_participation"/>


        <record id="view_event_resource_participation_tree" model="ir.ui.view">
            <field name="name">event.participation.resource.tree</field>
            <field name="model">event.participation</field>
            <field name="priority">100</field>
            <field name="arch" type="xml">
                <tree string="Participations" create="0" delete="0">
                    <field name="role"/>
                    <field name="partner_id" on_change="onchange_partner(partner_id)" required="1"/>
                    <field name="name" invisible="1"/>
                    <field name="seance_event_ids"/>
                    <field name="seance_id"/>
                    <field name="purchase_product_id"/>
                    <field name="purchase_price"/>
                    <field name="purchase_qty" sum="Quantity"/>
                    <field name="purchase_subtotal" sum="Sub-Total"/>
                    <field name="state"/>
                    <button name="button_set_draft"
                        states="confirm,cancel"
                        string="Set Draft" type="object"
                        icon="terp-crm"/>
                    <button name="button_set_confirm" string="Confirm"
                        states="draft,cancel"
                        type="object" icon="gtk-apply"/>
                    <button name="button_set_cancel" string="Cancel"
                        states="draft,confirm"
                        type="object" icon="gtk-cancel"/>
                </tree>
            </field>
        </record>

        <record id="view_event_participation_resource_search" model="ir.ui.view">
            <field name="name">event.participation.resource.search</field>
            <field name="model">event.participation</field>
            <field name="priority">100</field>
            <field name="arch" type="xml">
                <search string="Participations">
                    <field name="partner_id"/>
                    <field name="seance_id" invisible="1"/>
                    <field name="name" filter_domain="[('seance_id.name', 'ilike', self)]" string="Seance Name"/>
                    <field name="seance_event_ids"/>
                    <field name="state"/>
                    <separator/>
                    <filter name="state_draft" string="Draft" domain="[('state','=','draft')]"/>
                    <filter name="state_confirm" string="Confirm" domain="[('state','=','confirm')]"/>
                    <separator/>
                    <filter name="role_speaker" string="Speaker" domain="[('role','=','speaker')]"/>
                    <filter name="role_room" string="Room/Seat" domain="[('role','=', 'room')]"/>
                    <filter name="role_equipment" string="Equipment" domain="[('role','=','equipment')]"/>
                    <separator/>
                    <group string="Group By...">
                        <filter name="group_state" string="State" context="{'group_by': 'state'}"/>
                        <filter name="group_seance" string="Seance" context="{'group_by': 'seance_id'}"/>
                    </group>
                </search>
            </field>
        </record>

        <record id="action_event_resource_participation" model="ir.actions.act_window">
            <field name="name">Participations</field>
            <field name="res_model">event.participation</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[('role', '!=', 'participant')]</field>
            <field name="search_view_id" ref="view_event_participation_resource_search"/>
        </record>

        <record id="action_event_participation_tree" model="ir.actions.act_window.view">
            <field name="act_window_id" ref="action_event_resource_participation"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="view_event_resource_participation_tree"/>
        </record>

        <record id="action_event_participation_form" model="ir.actions.act_window.view">
            <field name="act_window_id" ref="action_event_resource_participation"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref=""/>
        </record>

        <menuitem id="menu_event_resource_participation"
                    parent="menu_event_resources_root"
                    action="action_event_resource_participation"
                    sequence="30"/>

        <record model="ir.ui.view" id="view_event_participation_group_tree">
            <field name="name">event.participation.group.tree</field>
            <field name="model">event.participation.group</field>
            <field name="arch" type="xml">
                <tree string="Groups">
                    <field name="name"/>
                    <field name="participant_count"/>
                    <field name="is_default"/>
                </tree>
            </field>
        </record>

        <record model="ir.ui.view" id="view_event_participation_group_form">
            <field name="name">event.participation.group.form</field>
            <field name="model">event.participation.group</field>
            <field name="arch" type="xml">
                <form string="Group" version="7.0">
                    <sheet>
                        <div class="oe_title">
                            <label for="name" class="oe_edit_only"/>
                            <h2><field name="name"/></h2>
                        </div>
                        <group>
                            <field name="is_default"/>
                        </group>
                        <field name="registration_ids" colspan="4"/>
                    </sheet>
                </form>
            </field>
        </record>

        <record id="action_registration_2_participation_link" model="ir.actions.act_window">
            <field name="name">Participations</field>
            <field name="res_model">event.participation</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="context">{'search_default_registration_id': active_id}</field>
            <field name="domain">[]</field>
        </record>

        <record model="ir.ui.view" id="view_event_registration_form_seance">
            <field name="name">event.registration.form.seance</field>
            <field name="model">event.registration</field>
            <field name="inherit_id" ref="event.view_event_registration_form"/>
            <field name="arch" type="xml">
                <field name="date_closed" position="after">
                    <field name="group_ids" widget="many2many_tags" attrs="{'readonly': [('state','=','done')]}"
                            domain="[('event_content_id.event_ids','in',[event_id])]"
                            on_change="onchange_group_ids(event_id, group_ids)"
                            context="{'show_content_name': 1}"/>
                </field>
                <xpath expr="//sheet/h1" position="before">
                    <div class="oe_right oe_button_box">
                        <button name="%(action_registration_2_participation_link)d" type="action" string="Participations"/>
                    </div>
                </xpath>
                <xpath expr="//sheet/group" position="after">
                    <field name="event_has_manual_participation" invisible="1"/>
                    <separator string="Manual Participations" attrs="{'invisible': [('event_has_manual_participation', '=', False)]}"/>
                    <field name="manual_participation_ids" attrs="{'invisible': [('event_has_manual_participation', '=', False)]}" context="{'default_partner_id': partner_id}">
                        <tree string="Manual Participations" editable="bottom">
                            <field name="partner_id" on_change="onchange_partner(partner_id)" required="1"/>
                            <field name="name" invisible="1"/>
                            <field name="seance_id" domain="[('type_id.manual_participation','=',True),('event_ids', 'in', [parent.event_id]),('date_begin','!=',False)]"/>
                            <field name="state"/>
                            <field name="presence" invisible="1"/>
                            <field name="presence_summary"/>
                            <button name="button_take_presence" type="object"
                                    string="Mark as Present" icon="kanban-apply"
                                    attrs="{'invisible': ['|',('state','not in',['draft', 'confirm']),('presence','=','present')]}"
                                    context="{'presence': 'present'}"/>
                            <button name="button_take_presence_2" type="object"
                                    string="Mark as Absent" icon="kanban-stop"
                                    attrs="{'invisible': ['|', ('state','not in',['draft', 'confirm']),('presence','=','absent')]}"
                                    context="{'presence': 'absent'}"/>
                            <button name="%(action_event_participation_take_presence_wizard)d" type="action"
                                    string="Mark as Late" icon="kanban-pause"
                                    attrs="{'invisible': ['|',('state','not in',['draft','confirm']),('presence','=','late')]}"
                                    context="{'default_status': 'late'}"/>
                        </tree>
                    </field>
                </xpath>
            </field>
        </record>

    </data>
</openerp>