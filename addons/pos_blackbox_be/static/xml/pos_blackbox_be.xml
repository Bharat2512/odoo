<?xml version="1.0" encoding="utf-8"?>

<templates id="template" inherit_id="point_of_sale.template">
    <t t-extend="DebugWidget">
        <t t-jquery="div.content" t-operation="append">
            <p class="category">Blackbox</p>
            <ul>
                <li class="button build-hash-and-sign-request">Build Hash&amp;Sign Request</li>
            </ul>
        </t>
    </t>

    <t t-name="BlackboxIdentificationWidget">
        <div class="oe_status js_blackbox_identification">
            <div class="oe_icon oe_green">
                <i class='fa fa-fw fa-archive'></i>
            </div>
        </div>
    </t>

    <!-- p18 -->
    <t t-extend="PosTicket">
        <t t-jquery="t[t-esc='moment().format(\'L LT\')']" t-operation="replace">
            <t t-esc="order.blackbox_pos_receipt_time.format('L LT')"/>
        </t>
        <t t-jquery=".pos-sale-ticket" t-operation="prepend">
            <div class="pos-center-align">VAT TICKET</div> <!-- todo jov: translate to BTW-KASTICKET -->
        </t>
        <t t-jquery="t[t-esc='widget.pos.company.name']" t-operation="after">
            <br />
            Address: <t t-esc="widget.pos.company.street"/><br />
            VAT number: <t t-esc="widget.pos.company.vat"/>
        </t>
        <t t-jquery="t[t-esc*='widget.pos.cashier']" t-operation="after">
            (ID: <t t-esc="widget.pos.get_cashier().insz_or_bis_number"/>)
        </t>
        <t t-jquery=".receipt-orderlines t[t-esc='widget.format_currency(orderline.get_display_price())']" t-operation="replace">
            <t t-esc="widget.format_currency(orderline.get_all_prices().priceWithTax)"/>
        </t>
        <t t-jquery=".receipt-orderlines td:last" t-operation="append">
            <t t-esc="orderline.get_vat_letter()"/>
        </t>
        <t t-jquery=".receipt-total t[t-foreach='order.get_tax_details()']" t-operation="replace">
            <t t-foreach="order.blackbox_base_price_in_euro_per_tax_letter" t-as="tax">
                <t t-if="tax.amount">
                    <tr>
                        <td>Tax category <t t-esc="tax.letter"/> (<t t-esc="order.get_tax_percentage_for_tax_letter(tax.letter)"/>%):</td>
                        <td class="pos-right-align">
                            <t t-esc="widget.format_currency(tax.amount)"/>
                        </td>
                    </tr>
                </t>
            </t>
        </t>
        <t t-jquery=".receipt-change" t-operation="after">
            <br />
            <table>
                <tr>
                    <td colspan="2">
                        <div class="pos-center-align">Control data</div>
                    </td>
                </tr>
                <tr>
                    <td>
                        FDM time:
                    </td>
                     <td class="pos-right-align"><t t-esc="order.blackbox_date"/>, <t t-esc="order.blackbox_time"/></td>
                </tr>
                <tr>
                    <td>FDM ticket counters:</td>
                    <td class="pos-right-align"><t t-esc="order.blackbox_ticket_counters"/></td>
                </tr>
                <tr>
                    <td>FDM ID:</td>
                    <td class="pos-right-align"><t t-esc="order.blackbox_unique_fdm_production_number"/></td>
                </tr>
                <tr>
                    <td>VSC ID:</td>
                    <td class="pos-right-align"><t t-esc="order.blackbox_vsc_identification_number"/></td>
                </tr>
                <tr>
                    <td>
                        PLU hash:
                    </td>
                    <td class="pos-right-align"><t t-esc="order.blackbox_plu_hash"/></td>
                </tr>
                <tr>
                    <td>
                        POS version:
                    </td>
                    <td class="pos-right-align"><t t-esc="order.blackbox_pos_version"/></td>
                </tr>
                <tr>
                    <td>
                        POS production ID:
                    </td>
                    <td class="pos-right-align"><t t-esc="order.blackbox_pos_production_id"/></td>
                </tr>
                <tr>
                    <td colspan="2">
                        <br />
                        <div class="pos-center-align">Ticket signature:</div>
                    </td>
                </tr>
                <tr>
                    <td colspan="2">
                        <div class="pos-center-align">
                            <t t-esc="order.blackbox_signature"/>
                        </div>
                    </td>
                </tr>
            </table>
        </t>
    </t>
</templates>
